localStorage.setItem("?admin_idleto",15);var idleto=localStorage.getItem(session+"_idleto");function idleTimer(){if(document.getElementById("timer")){var e=document.getElementById("timer");function t(){e.innerHTML=idleto+":00"}window.onmousemove=t,window.onmousedown=t,window.onclick=t,window.onscroll=t,window.onkeypress=t}}function startTimer(){if(document.getElementById("timer")){var e=document.getElementById("timer"),t=e.innerHTML.split(/[:]+/),s=t[0],a=checkSecond(t[1]-1);59==a&&(s-=1),0==s&&0==a&&(e.innerHTML="0:00",$("#logOut").click()),e.innerHTML=s+":"+a,setTimeout(startTimer,1e3)}}function checkSecond(e){return e<10&&e>=0&&(e="0"+e),e<0&&(e="59"),e}function countTableRow(e){var t=$("#"+e+" tr").filter(function(){return $(this).hasClass("yes")});$("#total-"+e).html(t.length)}function menuNonActive(e){$("#"+e).removeClass("block").addClass("hide"),$("#btn-"+e).removeClass("card-tab-active")}function menuActive(e){$("#"+e).removeClass("hide").addClass("block"),$("#btn-"+e).addClass("card-tab-active")}function filterBy(e,t,s){var a=document.getElementById(t);$("#"+t).val(s),filterTable(e,t),""==a.value?localStorage.setItem(session+"AutoReload",0):localStorage.setItem(session+"AutoReload",1),a.dispatchEvent(new KeyboardEvent("keyup",{key:"Shift"}))}function shPass(e){var t=$("#"+e);t.hasClass("key")?t.removeClass("key"):t.addClass("key")}function filterTable(e,t,s){var a=document.getElementById(t);$("#"+t).val(s),setClassYN(e,t),a.dispatchEvent(new KeyboardEvent("keyup",{key:"Shift"}))}function countReport(e,t){getprice=0,$("#"+e+" tr").filter(function(){return $(this).hasClass("yes")}).each(function(){getprice+=Number($(this).find("span").html())}),$("#"+t).html(currencyFormat(getprice,currency))}function countReportD(e,t){getprice=0,d=t.substring(5,3),m=t.substring(0,3),$("#"+e+" tr").filter(function(){return $(this).hasClass(t)}).each(function(){getprice+=Number($(this).find("span").html())});var s="['<b>"+d+" "+m+"</b>',"+getprice+"],";localStorage.getItem(session+"_resume_report")?localStorage.setItem(session+"_resume_report",localStorage.getItem(session+"_resume_report")+s):localStorage.setItem(session+"_resume_report",s)}function countReportT(e,s){getprice=0,d=s.substring(5,3),m=s.substring(0,3);var a=$("#"+e+" tr").filter(function(){return $(this).hasClass(s)});a.each(function(){getprice+=Number($(this).find("span").html())}),t=s.substring(0,3)+"/"+s.substring(5,3)+"/"+s.substring(9,5),tm=s.substring(0,3)+" "+s.substring(9,5),$("#count-report-t").html(currencyFormat(getprice,currency)),$("#count-vcr-t").html(a.length),$("#filterby-t").html(t.capitalize()),$("#filterby").html(tm.capitalize())}function filterTableReport(e,t,s,a){var o=new Date,i=(Number(o.getMonth()),document.getElementById(t));$("#"+t).val(s),setClassYN(e,t),i.dispatchEvent(new KeyboardEvent("keyup",{key:"Shift"})),countReport(e,a),$("#count-vcr").html($("#total-report").html()),tm=$("#filterby-t").html().split("/")[0]+" "+$("#filterby-t").html().split("/")[2],""==s?($("#filterby").html(tm.capitalize()),$("#ld-report").fadeIn(200)):($("#filterby").html(s),$("#ld-report").fadeOut(200))}function updateTable(e){document.getElementById(e).dispatchEvent(new KeyboardEvent("keyup",{key:"Shift"}))}function selectFirst(e){var t;for(idx=e.split(","),t=0;t<idx.length;t++)$("#"+idx[t]).val($("#"+idx[t]+" option:first").val())}function setClassYN(e,t){filter=new RegExp(String($("#"+t).val()),"i"),$("#"+e+" tr").filter(function(){$(this).each(function(){found=!1,$(this).children().each(function(){content=$(this).html(),content.match(filter)&&(found=!0)}),found?$(this).removeClass("no").addClass("yes"):$(this).removeClass("yes").addClass("no")})}),countTableRow(e)}function printVcr(e){"vc"==e.split("-")[0]||"up"==e.split("-")[0]?($("#printVcr").show(),$("#printVcrS").show(),$("#printVcr").attr("onclick",'pVcr("'+e+'","d")'),$("#printVcrS").attr("onclick",'pVcr("'+e+'","s")')):($("#printVcr").hide(),$("#printVcrS").hide())}function pVcr(e,t){window.open(session+"/print&"+t+"&c="+e,"_blank")}function setC(e){"vc"!=e.split("-")[0]&&"up"!=e.split("-")[0]||($("#select-comment").val(e),filterTable("users","searchUsers",e),printVcr(e))}function setTheme(e){var t=localStorage.getItem(session+"_theme");e!=t&&($.get({url:session+"/set_theme&theme="+e}).fail(function(){setTheme(e)}).always(function(){window.location.href=location.href.replace(/#/gi,"")}),localStorage.setItem(session+"_theme",e))}document.getElementById("timer")&&(document.getElementById("timer").innerHTML=idleto+":00"),"disable"===idleto||""===idleto?document.getElementById("timer")&&(document.getElementById("timer").innerHTML="00:00"):(idleTimer(),startTimer()),$("#iface-name").change(function(){var e=$("#iface-name").val();localStorage.setItem(session+"_iface",e),clearInterval(window.ifaceI),clearInterval(window.ifaceII),$.getJSON(session+"/get_traffic/&iface="+e,function(t){try{txrx='[{"name":"Tx","data":["'+t.tx+'"]},{"name":"Rx","data":["'+t.rx+'"]}]',localStorage.setItem(session+"_traffic_data",txrx),$("#applog").append("<tr><td>"+timeStamp()+"</td><td>Loading Traffic "+e+"</td></tr>"),scrollD()}catch(e){console.log("get_traffic"),$("#applog").append("<tr><td>"+timeStamp()+'</td><td style="color:#f86c6b;">get_traffic : timeout</td></tr>'),scrollD()}}).always(function(){trafficMonitor(localStorage.getItem(session+"_theme"))})});var jesD={dec:function(e,t=25){var s="";e.toString();for(var a=0;a<e.length;a++){var o=e.charCodeAt(a)^t;s+=String.fromCharCode(o)}return s}};function scrollD(){var e=$("#applogd"),t=e.scrollTop();e.scrollTop(t+100)}function timeStamp(){var e="",t=new Date,s=t.getHours(),a=t.getMinutes(),o=t.getSeconds();return a<10&&(a="0"+a),o<10&&(o="0"+o),e+=s+":"+a+":"+o}function makeid(e){for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=s.length,o=0;o<e;o++)t+=s.charAt(Math.floor(Math.random()*a));return t}function diffct(e){cct=timeStamp(),Number(e.split(":")[1]),Number(cct.split(":")[1]);var t=60*+Number(e.split(":")[0])+ +Number(e.split(":")[1]),s=60*+Number(cct.split(":")[0])+ +Number(cct.split(":")[1]);return s-t}function detHA(e){"none"==document.getElementById(e).style.display?($("#"+e).fadeIn(100),$("#t"+e).html('<i  class="fa fa-close"></i> close')):($("#"+e).fadeOut(100),$("#t"+e).html('<i  class="fa fa-caret-down"></i> details'))}function connect(e,t){$("#"+e).notify("Connecting...","info"),url="./?"+t+"/connect",$.get(url,function(s){var a=s.split(",")[0];"Connected"===a?(console.log(a),localStorage.setItem(t,a)):"Invalid username or password"===a?($("#"+e).notify(a,"error"),localStorage.setItem(t,a),console.log(a)):"Error"===a&&(console.log("Could not connect to MikroTik"),localStorage.setItem(t,"Could not connect to MikroTik"))}).always(function(){var s=localStorage.getItem(t);"Connected"===s?location.href="./?"+t:"Could not connect to MikroTik"===s?($("#"+e).notify(s,"error"),setsess()):setsess(),localStorage.setItem(t,"")})}function setsess(){$("#lsession")&&setTimeout(function(){$("#lsession").val($("#lsession option:first").val())},5e3)}function daysInMonth(e,t){return new Date(t,e,0).getDate()}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var yy=yyyy,tmm=mm+1;function setYear(e){for(i=yy;i>=2018;i--)$("#"+e).append('<option value="'+i+'">'+i+"</option>")}function setMonth(e){var t=["","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];for(i=1;i<13;i++)mm+1==i?$("#"+e).append('<option value="'+t[i]+'" selected>'+t[i].capitalize()+"</option>"):$("#"+e).append('<option value="'+t[i]+'">'+t[i].capitalize()+"</option>");$("#btnFilter").attr("title","Filter "+$("#month").val().capitalize()+" "+$("#year").val())}function setDay(e,t=tmm,s=yy){var a=daysInMonth(t,s);for($("#"+e).append('<option value="day">Day</option>'),i=1;i<a+1;i++)i<10&&(i="0"+i),$("#"+e).append('<option value="'+i+'">'+i+"</option>")}function filterMonth(e,t,s){var a=$("#"+t).val();console.log(a);var o=["","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(a),i=$("#"+s).val();$("#"+e).html(""),setDay(e,o,i),filterTableReport("report","searchReport","","count-report"),loadSReport(Number(o)+"/"+i)}function filterDay(e,t,s){t=$("#"+t).val(),s=$("#"+s).val();filterTableReport("report","searchReport","day"!==e?t+"/"+e+"/"+s:"","count-report")}function selectFO(e){selectTags=$("#"+e);for(var t=0;t<selectTags.length;t++)selectTags[t].selectedIndex=0}function setfilterProfile(){$(".hotspot-users").fancyTable({inputId:"searchUsers",sortColumn:2,pagination:!0,perPage:15,globalSearch:!0,globalSearchExcludeColumns:[2,3,8]})}function downloadCSV(e,t){var s,a;s=new Blob([e],{type:"text/csv"}),(a=document.createElement("a")).download=t,a.href=window.URL.createObjectURL(s),a.style.display="none",document.body.appendChild(a),a.click()}function exportToCSV(e,t){var s=[],a=$("#"+t+" tr").filter(function(){return $(this).hasClass("yes")});s.push($("title").html().toUpperCase()+",,,,,,,,"),s.push(e.split(".")[0].replace(/_|\?/gi," ").toUpperCase()+",,,,,,,,"),s.push(",,,,,,,,"),s.push(",,,,,,Qty,"+(a.length-1)+","),s.push(",,,,,,Total,=SUM(I8:I"+(a.length+6)+"),"),s.push(",,,,,,,,");for(var o=0;o<a.length;o++){var i=[],n=a[o].querySelectorAll("td, th");if(0==o)var r="#";else r=o;for(var l=0;l<n.length;l++)"dataReport"==t&&isMobile()?i.push(n[l].innerText.replace(/Date: | |\n/gi,"").replace(/Time:|Username:|IPAddress:|MACAddress:|Profile:|Comment:/gi,",").replace(/Address/gi," Address")):i.push(n[l].innerText);s.push(r+","+i.join(","))}downloadCSV(s.join("\n"),e)}function reportFN(e=session){var t=$("#filterby-t").html().split("/")[0]+"_"+$("#filterby-t").html().split("/")[2],s=$("#filterby").html().replace(/ /gi,"_");return"sales_report"+(e=e.replace(/-| /gi,"_"))+"_"+t+(s=t==s?"":"_"+s)+".csv"}function rFileName(e,t=session){var s=$("#filterby-t").html().split("/")[0]+"_"+$("#filterby-t").html().split("/")[2],a=$("#filterby").html().replace(/ /gi,"_");return"sales_report"+(t=t.replace(/-| /gi,"_"))+"_"+s+(a=s==a?"":"_"+a)+e}function exportToExcel(e,t){var s="",a=$("#"+e+" tr").find("td").first().parent().find("td").length+1,o=$("#"+e+" tr").not(".no").length+6,i="=MAX(A8:A"+o+")",n="=SUM(I8:I"+o+")",r="<tr><td style='font-weight:bold;text-align:center;' colspan='"+a+"'>"+$("title").html().toUpperCase()+"</td></tr>",l="<tr><td style='font-weight:bold;text-align:center;' colspan='"+a+"'>"+t.split(".")[0].replace(/_|\?/gi," ").toUpperCase()+"</td></tr>",c="<tr><td></td><td></td><td></td><td></td><td></td><td></td><td style='text-align:right;font-weight:bold'>Qty :</td><td style='text-align:right;font-weight:bold'>"+i+"</td></tr>",d="<tr><td></td><td></td><td></td><td></td><td></td><td></td><td style='text-align:right;font-weight:bold'>Amount :</td><td style='text-align:right;font-weight:bold'>"+n+"</td></tr>";$("#"+e+" tr").not(".no").each(function(e,t){tt=0==e?"<th>#</th>":"<td>"+e+"</td>",s+="<tr>"+tt+$(t).html()+"</tr>"});var m,u={worksheet:"Sales Report",table:r+l+"<tr><td></td></tr>"+c+d+"<tr><td></td></tr>"+s},p=document.createElement("a");p.download=t,p.href="data:application/vnd.ms-excel;base64,"+function(e){return window.btoa(unescape(encodeURIComponent(e)))}((m=u,'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(e,t){return m[t]}))),p.click()}function Theme(){$("#Mtheme").hasClass("hide")?($("#Mtheme").removeClass("hide"),$("#Mtheme").fadeIn("200")):($("#Mtheme").fadeOut("200"),$("#Mtheme").addClass("hide"))}function removeRouter(e){if(confirm("Are you sure want to remove session ["+e+"] ?")){"?admin"==session&&"settings"==path&&$.ajax({type:"POST",url:"./post/post_a_router.php",data:{do:"remove",router_:e},dataType:"json",success:function(e){"Success"==e.message?location.href="./?admin/settings":alert(e.message)}})}}function delay(e,t){var s=0;return function(){var a=this,o=arguments;clearTimeout(s),s=setTimeout(function(){e.apply(a,o)},t||0)}}function saveRouter(e){$("#r-mess").html('<i class="fa fa-cog fa-spin"></i>'),$("#r-mess").fadeIn(200),localStorage.setItem("?"+e+"_idleto",$("#idleTo").val());"?admin"==session&&"settings"==path&&$.ajax({type:"POST",url:"./post/post_a_router.php",data:{do:"save",router_:e,session:$("#sessName").val().replace("admin","user01"),ipmik:$("#ipHost").val(),usermik:$("#userHost").val(),passmik:$("#passwdHost").val(),hotspotname:$("#hotspotNane").val(),dnsname:$("#dnsName").val(),currency:$("#currency").val(),idleto:$("#idleTo").val(),phone:$("#phone").val()},dataType:"json",success:function(t){if("Success"==t.message){$("#r-mess").html("Saved &#10004;");var s=setTimeout(function(){$("#r-mess").fadeOut(200),$("#r-mess").html(""),clearTimeout(s)},1500);e!==t.sess?location.href="./?admin/settings/&r="+t.sess:$("#sessName").val(e)}else"__err_"==t.sess?$("#ee-mess").notify(t.message,"error"):(alert(t.message),window.location.href="./?admin/settings/&r="+t.sess)}})}function noR(e){localStorage.setItem("noR",e),1==localStorage.getItem("noR")?window.onbeforeunload=function(){return!0}:window.onbeforeunload=function(){}}function openUser(e,t){$("#usract-btn").show(),upath="uname"==t?"/user&name=":"/user&id=",$.get(session+upath+e,function(e){var t=jesD.dec(e);if("["==t.substring(0,1))e=JSON.parse(t);else e=JSON.parse(t.substring(1,t.length));var s=e[0].server,a=e[0]["limit-bytes-total"],o=e[0]["limit-uptime"];s||(s="all"),a||(a=""),"MiB"==formatBytes(a).substr(-3,3)?audlimit=a/1048576+"M":"GiB"==formatBytes(a).substr(-3,3)?audlimit=a/1073741824+"G":audlimit=a,limituptime=o?timeNice(o):"",$("#usrtt").html('<i class="fa fa-user"></i>&nbsp; <b>'+e[0].name+"</b> &nbsp;"),$("#add_hserver").val(s).change(),$("#add_usrid").val(e[0][".id"]),$("#add_usrname").val(e[0].name),$("#add_usrpass").val(e[0].password),$("#add_usrprofile").val(e[0].profile).change(),$("#add_usrmac").val(e[0]["mac-address"]),$("#add_tlimit").val(e[0]["limit-uptime"]),$("#add_dlimit").val(audlimit),$("#uuptime").val(timeNice(e[0].uptime)),$("#ubytesin").val(formatBytes(e[0]["bytes-in"])),$("#ubytesout").val(formatBytes(e[0]["bytes-out"])),$("#ulimituptime").val(limituptime),$("#ulimitbytestotal").val(formatBytes(a));var i=e[0].comment;i&&"/"==i.substr(3,1)&&"/"==i.substr(6,1)&&":"==i.substr(14,1)&&":"==i.substr(17,1)?($("#usrexp").val(i.substr(0,20)),$("#add_usrcomm").val(i.substr(21,i.length))):i&&"up-"==i.substr(0,3)&&"-"==i.substr(6,1)||i&&"vc-"==i.substr(0,3)&&"-"==i.substr(6,1)?($("#ucode").val(i.substr(0,16)),$("#add_usrcomm").val(i.substr(16,i.length))):i&&"up-"==i.substr(0,3)||i&&"vc-"==i.substr(0,3)?($("#ucode").val(i.substr(0,3)),$("#add_usrcomm").val(i.substr(3,i.length))):$("#add_usrcomm").val(i),$("#addh_user").fadeIn(),noR(1)})}function resetUser(){confirm("Are you sure want to reset user ["+$("#add_usrname").val()+"] ?")&&addUser("yes")}function addUser(e="no"){if($("#add_usrmsg").html("<span class='text-yellow'><i class='fa fa-circle'></i></span> processing..."),0==$("#add_usrid").val())var t="./post/post_add_user.php";else t="./post/post_update_user.php";var s=session,a=$("#add_dlimit").val(),o=$("#add_tlimit").val(),i=$("#add_usrcomm").val(),n=$("#usrexp").val();"M"==a.substr(-1,1)?adlimit=1048576*Number(a.substr(0,a.length-1)):"G"==a.substr(-1,1)?adlimit=1073741824*Number(a.substr(0,a.length-1)):adlimit=""==a?0:a;var r,l="";l=""==$("#add_usrmac").val()?"00:00:00:00:00:00":$("#add_usrmac").val(),atlimit=""==o?0:o,"yes"==e&&($("#add_tlimit").val(""),$("#usrexp").val(""),$("#ucode").val(""),atlimit=0,i=$("#add_usrname").val()==$("#add_usrpass").val()?"vc-"+i:"up-"+i,n=""),"?admin"!==session&&$.ajax({type:"POST",url:t,data:{sessname:s,uid:$("#add_usrid").val(),server:$("#add_hserver").val(),name:$("#add_usrname").val(),password:$("#add_usrpass").val(),profile:$("#add_usrprofile").val(),macaddr:l,timelimit:atlimit,datalimit:adlimit,comment:i,expdate:n,reset:e,ucode:$("#ucode").val()},dataType:"json",success:function(e){if("success"==e.message){$("#usract-btn").show(),$("#add_usrmsg").html("<span class='text-green'><i class='fa fa-circle'></i></span> "+e.message),$("#add_usrid").val(e.data[".id"]),e.data["mac-address"]&&(r=e.data["mac-address"]),$("#add_usrmac").val(r);var t=e.data.comment;t&&"/"==t.substr(3,1)&&"/"==t.substr(6,1)&&":"==t.substr(14,1)&&":"==t.substr(17,1)?($("#usrexp").val(t.substr(0,20)),$("#add_usrcomm").val(t.substr(21,t.length))):t&&"up-"==t.substr(0,3)&&"-"==t.substr(6,1)||t&&"vc-"==t.substr(0,3)&&"-"==t.substr(6,1)?($("#ucode").val(t.substr(0,16)),$("#add_usrcomm").val(t.substr(16,t.length))):t&&"up-"==t.substr(0,3)||t&&"vc-"==t.substr(0,3)?($("#ucode").val(t.substr(0,3)),$("#add_usrcomm").val(t.substr(3,t.length))):$("#add_usrcomm").val(t),$("#uuptime").val(timeNice(e.data.uptime)),$("#ubytesin").val(formatBytes(e.data["bytes-in"])),$("#ubytesout").val(formatBytes(e.data["bytes-out"]));var a=e.data["limit-uptime"];a?(limituptime=timeNice(a),$("#add_tlimit").val(a)):limituptime="",$("#ulimituptime").val(limituptime),$("#ulimitbytestotal").val(formatBytes(adlimit)),$("#usrtt").html('<i class="fa fa-user"></i>&nbsp; <b>'+e.data.name+"</b> &nbsp;"),$.get(s+"/users/&prof="+e.data.profile+"&f=true").always(function(){loadUsersPPF()}),setTimeout(function(){$("#add_usrmsg").html("&nbsp;")},3e3)}else $("#add_usrmsg").html("<span class='text-red'><i class='fa fa-circle'></i></span> "+e.data.error),setTimeout(function(){$("#add_usrmsg").html("&nbsp;")},3e3)}})}function remUser(){removeUser($("#add_usrid").val(),$("#add_usrname").val(),$("#add_usrprofile").val())}function removeUser(e,t,s){if(confirm("Are you sure want to remove user ["+t+"] ?")){var a=session;"?admin"!==session&&"hotspot"==path&&$.ajax({type:"POST",url:"./post/post_hotspot_remove.php",data:{sessname:a,where:"user_",id:e},dataType:"json",success:function(e){"success"==e.message?$.get(a+"/users/&prof="+s+"&f=true").always(function(){loadUsersPPF()}):location.reload()}}),$("#huClose").click()}}function removeProfile(e,t){if(confirm("Are you sure want to remove profile ["+t+"] ?")){var s=session;"?admin"!==session&&"hotspot"==path&&$.ajax({type:"POST",url:"./post/post_hotspot_remove.php",data:{sessname:s,where:"profile_",id:e},dataType:"json",success:function(e){"success"==e.message?loadUserProfiles("true"):location.reload()}})}}function removeActive(e,t){if(confirm("Are you sure want to remove user ["+t+"] ?")){var s=session;"?admin"!==session&&"hotspot"==path&&$.ajax({type:"POST",url:"./post/post_hotspot_remove.php",data:{sessname:s,where:"active_",id:e},dataType:"json",success:function(e){"success"==e.message?(clearInterval(window.auto_hotspot_active),loadHotspotActive()):location.reload()}})}}function removeHost(e,t){if(confirm("Are you sure want to remove MAC ["+t+"] ?")){var s=session;"?admin"!==session&&"hotspot"==path&&$.ajax({type:"POST",url:"./post/post_hotspot_remove.php",data:{sessname:s,where:"host_",id:e},dataType:"json",success:function(e){"success"==e.message?(clearInterval(window.auto_hotspot_hosts),loadHotspotHosts()):location.reload()}})}}function setExpMon(){var e=session;"?admin"!==session&&$.ajax({type:"POST",url:"./post/post_expire_monitor.php",data:{sessname:e,expmon:':local dateint do={:local montharray ( "jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec" );:local days [ :pick $d 4 6 ];:local month [ :pick $d 0 3 ];:local year [ :pick $d 7 11 ];:local monthint ([ :find $montharray $month]);:local month ($monthint + 1);:if ( [len $month] = 1) do={:local zero ("0");:return [:tonum ("$year$zero$month$days")];} else={:return [:tonum ("$year$month$days")];}};:local timeint do={:local hours [ :pick $t 0 2 ];:local minutes [ :pick $t 3 5 ];:return ($hours * 60 + $minutes) ;};:local date [ /system clock get date ];:local time [ /system clock get time ];:local today [$dateint d=$date] ;:local curtime [$timeint t=$time] ;:local tyear [ :pick $date 7 11 ];:local lyear ($tyear-1);:foreach i in [ /ip hotspot user find where comment~"/$tyear" || comment~"/$lyear" ] do={:local comment [ /ip hotspot user get $i comment]; :local limit [ /ip hotspot user get $i limit-uptime]; :local name [ /ip hotspot user get $i name]; :local gettime [:pic $comment 12 20];:if ([:pic $comment 3] = "/" and [:pic $comment 6] = "/") do={:local expd [$dateint d=$comment] ;:local expt [$timeint t=$gettime] ;:if (($expd < $today and $expt < $curtime) or ($expd < $today and $expt > $curtime) or ($expd = $today and $expt < $curtime) and $limit != "00:00:01") do={ :if ([:pic $comment 21] = "N") do={[ /ip hotspot user set limit-uptime=1s $i ];[ /ip hotspot active remove [find where user=$name] ];} else={[ /ip hotspot user remove $i ];[ /ip hotspot active remove [find where user=$name] ];}}}}}'},dataType:"json",success:function(e){"success"==e.message&&($("#exp_mon").html('<i class="fa fa-ci fa-circle text-green" title="Expire users monitor is activated."></i>'),$("#btn-exp-mon").fadeOut(200))}})}function editRouter(e){location.href="./?admin/settings/&r="+e}function getInterval(){return localStorage.getItem(session+"_auto_traffic")}function fileUpChk(e){"png"!==e.files[0].name.split(".").pop()?alert("Please choose .png file type."):e.files[0].size/1024/1024>1?alert("File to large ["+formatBytes(e.files[0].size)+"], max 1 MiB."):$("#tempfileup").html(e.files[0].name+" ["+formatBytes(e.files[0].size)+"]")}$("#month").change(function(){$("#btnFilter").attr("title","Filter "+$("#month").val().capitalize()+" "+$("#year").val())}),$("#year").change(function(){$("#btnFilter").attr("title","Filter "+$("#month").val().capitalize()+" "+$("#year").val())}),$("#logOut").click(function(){$.ajax({type:"POST",url:"./post/post_logout.php",data:{logout:session},success:function(e){session===e&&(localStorage.setItem("typeTemplate",""),localStorage.setItem(session+"_cache_user_profiles",""),location.replace("./?login"))}})}),$("#btn-add-router").click(function(){$("#add-router-message").html("Creating a new config..."),$("#add-router-message").fadeIn(200);"?admin"==session&&"settings"==path&&$.ajax({type:"POST",url:"./post/post_a_router.php",data:{do:"add",router_:"sess_"},dataType:"json",success:function(e){"Success"==e.message?location.href="./?admin/settings/&r="+e.sesname:($("#add-router-message").css({width:"500px"}),$("#add-router-message").html(e.message),$("#add-router-message").fadeIn(200),setTimeout(function(){$("#add-router-message").fadeOut(200)},5e3))}})}),$(".asave").keyup(delay(function(e){saveRouter($("#sessName").val())},1e3)),$("#idleTo").change(delay(function(e){saveRouter($("#sessName").val())},1e3)),$("#sessName").keyup(delay(function(e){$("#saveR").click()},1e3)),$(".adm").keyup(delay(function(e){$("#btn-asave").click()},1e3)),$("#rConnect").click(function(){connect("ee-mess",$("#sessName").val())}),$("#saveR").click(function(){saveRouter(new URL(window.location).searchParams.get("r"))}),$("#btn-asave").click(function(){$("#a-mess").html('<i class="fa fa-cog fa-spin"></i>'),$("#a-mess").fadeIn(200);"?admin"==session&&"settings"==path&&$.ajax({type:"POST",url:"./post/post_a_router.php",data:{do:"saveAdmin",router_:session,username:$("#userAdm").val(),password:$("#passAdm").val()},dataType:"json",success:function(e){"Success"==e.message?($("#a-mess").html("Saved &#10004;"),setTimeout(function(){$("#a-mess").fadeOut(200)},1e3)):($("#e-mess").html(e.message),$("#e-mess").fadeIn(200),setTimeout(function(){$("#e-mess").fadeOut(200),$("#a-mess").fadeOut(200),$("#e-mess").html("")},3e3))}})}),$("#btn-mm-admin").click(function(){menuActive("mm-admin"),menuNonActive("router-list"),menuNonActive("edit-router"),isMobile()&&$("#pload").html($("#btn-mm-admin").html())}),$("#btn-router-list").click(function(){menuNonActive("mm-admin"),menuNonActive("edit-router"),menuActive("router-list"),isMobile()&&$("#pload").html($("#btn-router-list").html())}),$("#btn-edit-router").click(function(){menuNonActive("mm-admin"),menuNonActive("router-list"),menuActive("edit-router"),isMobile()&&$("#pload").html($("#btn-edit-router").html())}),$("#btn-general").click(function(){$("#btn-details").removeClass("card-tab-active"),$("#udetails").addClass("hide"),$("#btn-general").addClass("card-tab-active"),$("#ugeneral").removeClass("hide")}),$("#btn-details").click(function(){$("#btn-details").addClass("card-tab-active"),$("#udetails").removeClass("hide"),$("#btn-general").removeClass("card-tab-active"),$("#ugeneral").addClass("hide")}),$(".btn-add-hotspot-users").click(function(){$("#addh_user").fadeIn(),noR(1)}),$("#huClose").click(function(){$("#addh_user").fadeOut(),setTimeout(function(){$("#btn-general").click(),$("#add_hserver").val($("#add_hserver option:first").val()),$("#add_usrid").val("0"),$("#add_usrname").val(""),$("#add_usrpass").val(""),$("#add_usrprofile").val($("#add_usrprofile option:first").val()),$("#add_usrmac").val(""),$("#add_tlimit").val(""),$("#add_dlimit").val(""),$("#add_usrcomm").val(""),$("#uuptime").val(""),$("#ubytesin").val(""),$("#ubytesout").val(""),$("#ulimituptime").val(""),$("#ulimitbytestotal").val(""),$("#usrexp").val(""),$("#ucode").val(""),$("#usract-btn").hide(),$("#usrtt").html('<i class="fa fa-user-plus"></i>&nbsp; <b>Add User</b> &nbsp;')},700),noR(0)}),$("#browsefile").click(function(){$("#fileup").click()});var sq=location.hostname.split(".");if("?admin"==session&&"template_editor"==path){var editor=CodeMirror.fromTextArea(document.getElementById("editorMikhmon"),{lineNumbers:!0,matchBrackets:!0,mode:"application/x-httpd-php",indentUnit:4,indentWithTabs:!0,lineWrapping:!0,viewportMargin:1/0,matchTags:{bothTags:!0},autoCloseBrackets:!0,autoCloseTags:!0,keyMap:"sublime",extraKeys:{"Ctrl-J":"toMatchingTag"}});editor.setOption("theme","material"),editor.refresh()}function loadTemplate(e){$("#select-template option[value="+localStorage.getItem("nameTemplate")+"]").attr("selected","selected"),localStorage.setItem("typeTemplate",e),localStorage.setItem("nameTemplate",$("#select-template").val());var t=localStorage.getItem("typeTemplate"),s=localStorage.getItem("nameTemplate");localStorage.setItem("tmplPath",t+"."+s+".txt"),$.get("./template/"+t+"."+s+".txt?"+(new Date).getTime(),function(e){editor.setValue(e),editor.refresh()}).always(function(){"header"==e?$("#active-edit").html("/template/"+s+"."+t+".txt"):"row"==e?$("#active-edit").html("/template/"+s+"."+t+".txt"):"footer"==e&&$("#active-edit").html("/template/"+s+"."+t+".txt"),$("#select-template").addClass("btn-group-active")})}function dropD(){$("#mDropdown").hasClass("show")?$("#mDropdown").removeClass("show"):$("#mDropdown").addClass("show")}$("#btn-tsave").click(function(){$("#loading").html('<i class="fa fa-cog fa-spin"></i>'),$("#loading").fadeIn(200);var e=localStorage.getItem("tmplPath");"?admin"==session&&"template_editor"==path&&$.ajax({type:"POST",url:"./post/post_template.php",data:{do:"saveTemplate",router_:session,file_:e,_template:editor.getValue()},dataType:"json",success:function(e){"Saved"==e.message?($("#loading").html("Saved &#10004;"),setTimeout(function(){$("#loading").fadeOut(200),$("#loading").html("&nbsp;")},1e3)):$("#t_err").notify(e.message,"error")}})}),$("#select-template").change(function(){loadTemplate("row",this.value)}),isMobile()&&$(document).click()&&$("#mDropdown a").click(function(){$("#mDropdown").removeClass("show")});